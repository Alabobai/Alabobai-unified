#!/usr/bin/env npx ts-node
/**
 * Security Test Runner
 *
 * Executes all security tests including:
 * - Prompt injection detection
 * - Data leak prevention
 * - Input sanitization
 * - Output filtering
 *
 * Usage: npx ts-node src/security/runSecurityTests.ts
 */

import { runSecurityHarness } from './PromptInjectionGuard'
import { dataLeakPrevention } from './DataLeakPrevention'

async function main() {
  console.log('\n')
  console.log('â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—')
  console.log('â•‘                                                              â•‘')
  console.log('â•‘           ðŸ”’ ALABOBAI SECURITY HARNESS ðŸ”’                    â•‘')
  console.log('â•‘                                                              â•‘')
  console.log('â•‘   Testing prompt injection & data leak protection           â•‘')
  console.log('â•‘                                                              â•‘')
  console.log('â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•')
  console.log('\n')

  let totalPassed = 0
  let totalFailed = 0
  let criticalIssues = 0

  // Run Prompt Injection Tests
  console.log('\n\n')
  console.log('â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”')
  console.log('â”‚  PART 1: PROMPT INJECTION PROTECTION                        â”‚')
  console.log('â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜')

  const injectionResults = await runSecurityHarness()

  for (const result of injectionResults) {
    if (result.passed) {
      totalPassed++
    } else {
      totalFailed++
      if (result.severity === 'critical') {
        criticalIssues++
      }
    }
  }

  // Run Data Leak Prevention Tests
  console.log('\n\n')
  console.log('â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”')
  console.log('â”‚  PART 2: DATA LEAK PREVENTION                                â”‚')
  console.log('â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜')

  const dlpResults = await dataLeakPrevention.runTests()
  totalPassed += dlpResults.passed
  totalFailed += dlpResults.failed

  // Final Summary
  console.log('\n\n')
  console.log('â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—')
  console.log('â•‘                    FINAL SUMMARY                             â•‘')
  console.log('â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•')
  console.log('\n')

  const total = totalPassed + totalFailed
  const passRate = ((totalPassed / total) * 100).toFixed(1)

  console.log(`  ðŸ“Š Total Tests:     ${total}`)
  console.log(`  âœ… Passed:          ${totalPassed}`)
  console.log(`  âŒ Failed:          ${totalFailed}`)
  console.log(`  ðŸ“ˆ Pass Rate:       ${passRate}%`)

  if (criticalIssues > 0) {
    console.log(`  ðŸš¨ Critical Issues: ${criticalIssues}`)
  }

  console.log('\n')

  if (totalFailed === 0) {
    console.log('  â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—')
    console.log('  â•‘  ðŸŽ‰ ALL SECURITY TESTS PASSED! Platform is secure.    â•‘')
    console.log('  â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•')
  } else if (criticalIssues > 0) {
    console.log('  â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—')
    console.log('  â•‘  ðŸš¨ CRITICAL: Security vulnerabilities detected!      â•‘')
    console.log('  â•‘  Immediate action required.                           â•‘')
    console.log('  â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•')
  } else {
    console.log('  â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—')
    console.log('  â•‘  âš ï¸  Some tests need attention. Review results above. â•‘')
    console.log('  â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•')
  }

  console.log('\n')

  // Exit with appropriate code
  process.exit(criticalIssues > 0 ? 1 : 0)
}

main().catch((error) => {
  console.error('Security harness failed:', error)
  process.exit(1)
})
